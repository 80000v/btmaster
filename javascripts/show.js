function submitComment(){var a=$F("content").trim();if(!a){Window.alert("评论内容不能为空！");return false;}var b=a.length;if(Config.comment_length<b){Window.alert("评论内容长度超过限制！\n当前长度："+b+"，允许的长度："+Config.comment_length);return false;}var c="";if(1==Config.verify_code_comment){c=$F("vcode").trim();if(!c){Window.alert("请填写验证码！");return false;}}$("submit").disabled=true;$("post_notice").setStyle("display","");new Request({url:"ajax.php?act=comment&data_id="+data_id,data:{op:"post",content:a,quote_id:quote_id,vcode:c},onFailure:function(){Window.alert("评论数据提交错误，请稍后再试！");$("post_notice").setStyle("display","none");},onComplete:function(){var d=JSON.decode(this.response.text);$("post_notice").setStyle("display","none");if(null==d){Window.alert("评论数据提交错误，请稍后再试！");return;}if("succeed"==d.status){$("content").value="";quote_id=0;$("quote_object").setStyle("display","none");if(c){($("vcode").value="");imgRefresh("comment");}if(d.value){Window.alert(d.value);}else{loadComment(1);}}else{Window.alert(d.value);}}}).send();$("submit").disabled=false;return true;}function loadComment(b,a){if(!b||0>=b){b=1;}_c_c_page=b;new Request({url:"ajax.php?act=comment&data_id="+data_id,data:{op:"list",page:b},onFailure:function(){Window.alert("评论加载失败，请重试！");},onComplete:function(){var h=JSON.decode(this.response.text);var c=h.list;var g="";if(0<h.total){var d=c.length;for(var f=0;f<d;f++){var k=c[f];g+='<div class="cbox" id="comment_'+k.cid+'">';g+='    <div class="author_info">';var j='<span id="author_'+k.cid+'">';if(k.location){if("UNKNOWN"==k.location){k.location="火星";}j+="来自 "+k.location+"("+k.ip+") 的网友";}else{j+="网友("+k.ip+")";}j+="</span>";g+='        <span class="left">'+j+"发表于 "+k.date+"</span>";g+='        <span class="right"><span id="func_msg_'+k.cid+'"></span>&nbsp;&nbsp;<a href="javascript:void(0);" onclick="commentQuote('+k.cid+');return false;" title="引用回复该评论">引用</a> | <a href="javascript:void(0);" onclick="commentVote('+k.cid+', 1);return false;" title="赞同该观点">支持(<span id="vote_1_'+k.cid+'">'+k.agree+'</span>)</a> | <a href="javascript:void(0);" onclick="commentVote('+k.cid+', 0);return false;" title="反对该观点">反对(<span id="vote_0_'+k.cid+'">'+k.oppose+'</span>)</a> | <a href="javascript:void(0);" onclick="commentVote('+k.cid+', 2);return false;" title="违法/垃圾信息举报">举报</a>';g+="        </span>";g+="    </div>";g+='    <div class="content">'+k.content+"</div>";g+="</div>";}}else{g+='<p align="center">暂无评论显示</p>';}if(h.total){$("comment_total1").set("text",h.total);$("comment_total2").set("text",h.total);}if(h.page){$("c_m_page_top").setStyle("display","");$("c_m_page_bottom").setStyle("display","");var e='<div class="pagec clear"><span class="left">第'+_c_c_page+"页, 共"+h.totalpage+'页</span><span class="right">'+h.page+"</span></div>";$("c_m_page_top").set("html",e);$("c_m_page_bottom").set("html",e);}$("comment_list").set("html",g);if(true!==a){window.scroll(0,$("commentarea").getPosition().y-1);}}}).send();}function commentVote(c,b){var a="vote"+(2==b.toInt()?b:"")+c;if(Cookie.read(a)){commentVoteStatus(c,b,"exists");return false;}new Request({url:"ajax.php?act=comment&data_id="+data_id,data:{op:"vote",cid:c,type:b},onFailure:function(){commentVoteStatus(c,b,"error");},onComplete:function(){commentVoteStatus(c,b,this.response.text);}}).send();}function commentVoteStatus(e,d,b){$("func_msg_"+e).setStyle("display","inline");if("succeed"==b){if("2"!=d){var a="vote_"+d+"_"+e;$(a).set("text",$(a).get("text").toInt()+1);}var c="vote"+(2==d.toInt()?d:"")+e;Cookie.write(c,1,{duration:365});$("func_msg_"+e).set("text",(d=="2"?"感谢您的举报":"感谢您的参与"));}else{if("exists"==b){$("func_msg_"+e).set("text",(d=="2"?"请勿重复举报":"您已投过票了"));}else{b="error";$("func_msg_"+e).set("text","系统错误,请稍后再试");}}$("func_msg_"+e).className=b;(function(){this.setStyle("display","none");}).delay(3000,$("func_msg_"+e));}function commentQuote(a){quote_id=a;$("quote_object").setStyle("display","block");$("quote_object").set("html","引用回复 "+$("author_"+a).get("text")+' 发表的评论&nbsp;&nbsp;<a href="javascript:void(0);" onclick="commentQuoteCancel();return false;">取消引用</a>');$("content").focus();}function commentQuoteCancel(){quote_id=0;$("quote_object").setStyle("display","none");}function insertSmilie(c){var f=$("content").value;if(""!=f){var b=f.match(/\[smilie\:\d+\]/ig);if(b&&Config.comment_smilie_num<=b.length){return false;}}var a="[smilie:"+c+"]";$("content").focus();var e=$("content");selection=document.selection;if(typeof e.selectionStart!="undefined"){e.value=e.value.substr(0,e.selectionStart)+a+e.value.substr(e.selectionEnd);}else{if(selection&&selection.createRange){var d=selection.createRange();d.text=a;}else{e.value+=a;}}}function submitReport(){var a=$F("report_contact").trim();var b=$F("report_content").trim();if(!b){Window.alert("请填写您的举报原因！","stop",{mask:false});return false;}new Request({url:"ajax.php",data:{op:"report",id:data_id,contact:a,content:b},onFailure:function(){Window.alert("举报提交失败，请重试！","stop",{mask:false});return false;},onComplete:function(){var c=JSON.decode(this.response.text);if("succeed"==c.status){Window.alert("举报信息已成功提交，感谢您的支持！","clue",{mask:false});$("report_contact").value="";$("report_content").value="";(function(){Window.close("report");}).delay(1000);}else{Window.alert(c.value,"stop",{mask:false});return false;}}}).send();}